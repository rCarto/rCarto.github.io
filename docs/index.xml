<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>R Geomatic</title>
<link>https://rcarto.github.io/</link>
<atom:link href="https://rcarto.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>Information on R spatial packages maintained by Timothée Giraud.</description>
<generator>quarto-1.6.40</generator>
<lastBuildDate>Mon, 04 Nov 2024 23:00:00 GMT</lastBuildDate>
<item>
  <title>New release of mapsf</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/mapsf_v0.12.0/</link>
  <description><![CDATA[ 




<p>An update of <code>mapsf</code> has been deployed on CRAN.<br>
The package now includes two new functions: <code>mf_get_borders()</code> and <code>mf_get_pencil()</code>. The first function extracts borders between polygons which can be used to create discontinuities maps. The second one transforms polygons into lines, simulating a pencil drawing pattern.<br>
Other changes are bug fixes and minor improvements.</p>
<p>The dataset used in the following examples concerns apartment rental prices in 2023 (<small><a href="https://www.data.gouv.fr/fr/datasets/carte-des-loyers-indicateurs-de-loyers-dannonce-par-commune-en-2023/#/resources/43618998-3b37-4a69-bb25-f321f1a93ed1">source</a></small>).<br>
<small>Download the dataset:</small> <a href="com.gpkg"><i class="fa-solid fa-download" aria-label="download"></i></a></p>
<section id="new-features" class="level2">
<h2 class="anchored" data-anchor-id="new-features">New features</h2>
<section id="discontinuities-maps-with-mf_get_borders" class="level3">
<h3 class="anchored" data-anchor-id="discontinuities-maps-with-mf_get_borders">Discontinuities maps with <code>mf_get_borders()</code></h3>
<p>Discontinuities maps display the variation of a phenomenon between contiguous administrative units. This kind of representation does not focus on homogeneous zones, but rather on spatial breaks. On the map, discontinuity intensity is expressed by the thickness of the borders.</p>
<p>The first step to building these maps is to extract borders between units. The second step is to compute a discontinuity measure (either a ratio or an absolute difference). The third step is to display it on a map using a variations in line width. Combining these discontinuities with a choropleth representation helps to understand the discontinuity direction (which one of two regions has the higher value).</p>
<p><code>mf_get_borders()</code> is used to build the spatial object of borders between units. Each resulting border is described by the datasets of its two neighboring units in order to compute the discontinuity measures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import dataset </span></span>
<span id="cb1-5">com <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dsn =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"com.gpkg"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layer =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"communes"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get borders</span></span>
<span id="cb1-8">com_bo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_borders</span>(com) </span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute the gap between prices</span></span>
<span id="cb1-11">com_bo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>diff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(com_bo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>loypredm2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> com_bo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>loypredm2<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1</span>)</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set a cartographic theme</span></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkula"</span>,</span>
<span id="cb1-15">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb1-16">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inner =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb1-17">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb1-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tab =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display a choropleth map of the rent price / m²</span></span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> com, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loypredm2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>,</span>
<span id="cb1-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ckmeans"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nbreaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Emrld"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rev =</span> T,</span>
<span id="cb1-23">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-24">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rent price</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">indicator</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(€ per m²)"</span>,</span>
<span id="cb1-25">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_cex =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_rnd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>)</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display discontinuities</span></span>
<span id="cb1-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> com_bo[com_bo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>diff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diff"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grad"</span>,</span>
<span id="cb1-29">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="cb1-30">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Price gap</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(€ per m²)"</span>,</span>
<span id="cb1-31">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_rnd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_adj =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb1-32">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_cex =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Layout elements</span></span>
<span id="cb1-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>)</span>
<span id="cb1-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(</span>
<span id="cb1-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">txt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(</span>
<span id="cb1-38">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Timothée Giraud, 2024</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,</span>
<span id="cb1-39">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ADMIN EXPRESS COG CARTO - IGN, 2024</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,</span>
<span id="cb1-40">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"Carte des loyers" - Ministère de la Transition écologique, 2023'</span></span>
<span id="cb1-41">  )</span>
<span id="cb1-42">)</span>
<span id="cb1-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Discontinuities in rental price levels in Paris"</span>)</span>
<span id="cb1-44"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_annotation</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> com_bo[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(com_bo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>diff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), ][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ],</span>
<span id="cb1-45">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">txt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The largest gap is between</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Paris XVII (29.2€/m²) and</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, </span>
<span id="cb1-46">                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Saint-Ouen (20.3€/m²)"</span>),</span>
<span id="cb1-47">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">halo =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_arrow =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_txt =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb1-48">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>)</span>
<span id="cb1-49"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_scale</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.12.0/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="colored-pencil-maps-with-mf_get_pencil" class="level3">
<h3 class="anchored" data-anchor-id="colored-pencil-maps-with-mf_get_pencil">Colored pencil maps with <code>mf_get_pencil()</code></h3>
<p><code>mf_get_pencil()</code> transforms POLYGONS or MULTIPOLYGONS geometries in MULTILINESTRINGS geometries. This function creates a layer that mimicks a pencil drawing pattern. The following code details how to use the function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform the POLYGON layer in a MULTILINESTRING layer</span></span>
<span id="cb2-2">comx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_pencil</span>(com, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set a cartographic theme</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"candy"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display the map as a choropleth map</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> comx, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loypredm2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>,</span>
<span id="cb2-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ckmeans"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nbreaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mako"</span>,</span>
<span id="cb2-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rent price</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">indicator</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(€ per m²)"</span>,</span>
<span id="cb2-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_cex =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_rnd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>)</span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(com, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.fg"</span>))</span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Layout elements</span></span>
<span id="cb2-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>)</span>
<span id="cb2-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(</span>
<span id="cb2-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">txt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(</span>
<span id="cb2-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Timothée Giraud, 2024</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,</span>
<span id="cb2-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ADMIN EXPRESS COG CARTO - IGN, 2024</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,</span>
<span id="cb2-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"Carte des loyers" - Ministère de la Transition écologique, 2023'</span></span>
<span id="cb2-21">  )</span>
<span id="cb2-22">)</span>
<span id="cb2-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rental price levels in Paris"</span>)</span>
<span id="cb2-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_scale</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.12.0/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bug-fixes-and-improvements" class="level2">
<h2 class="anchored" data-anchor-id="bug-fixes-and-improvements">Bug fixes and improvements</h2>
<section id="lines-titles" class="level3">
<h3 class="anchored" data-anchor-id="lines-titles">2 lines titles</h3>
<p>A fix has made it easier to create titles on two lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set a suitable cartographic thme</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb3-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inner =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(com)</span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display the title</span></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"This title is easlily</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">displayed on 2 lines"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.12.0/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-better-north-arrow" class="level3">
<h3 class="anchored" data-anchor-id="a-better-north-arrow">A better north arrow</h3>
<p>The north arrow has been redesigned. It is now possible to change its size (cex), fine-tune its position (adj) or use a true north azimuth (align).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jsk"</span>)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use a projection that will produce a map where the north is not at the top</span></span>
<span id="cb4-3">com_usa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(com, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:32119"</span>)</span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(com_usa)</span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> com_usa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_graticule</span>(com_usa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">txt =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A better north arrow"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.12.0/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="new-classification-methods" class="level3">
<h3 class="anchored" data-anchor-id="new-classification-methods">New classification methods</h3>
<p>The “Q6” and “ckmeans” methods have been added to the <code>mf_get_breaks()</code> function.</p>
<ul>
<li><p>The “Q6” method has also been added, it’s a variation of the “q6” method.</p></li>
<li><p>The “jenks”, “fisher” and “ckmeans” methods are based on the same concept of natural breaks and produce similar groupings.</p>
<ul>
<li>The “jenks” method produces class boundaries that fall on data points and is slow.</li>
<li>The “fisher” method produces class boundaries placed more conveniently between data points, and is faster than the “jenks” method.</li>
<li>The “ckmeans” method produces the exact same class boundaries as the “fisher” method, but is much faster. It uses the optimal univariate k-means method from the <code>Ckmeans.1d.dp</code> package <span class="citation" data-cites="Wang2011Ckmeans">(Wang and Song 2011)</span>. If the “ckmeans” method is selected but the <code>Ckmeans.1d.dp</code> package is not installed then the “fisher” method is used.</li>
</ul>
<p>The relative speeds of these three methods may vary depending on the number of data points and the number of classes.</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="&quot;fisher&quot; vs. &quot;ckmeans&quot;">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
“fisher” vs.&nbsp;“ckmeans”
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Jenks isn’t even included due to the prohibitive amount of time it would take.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(microbenchmark)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fisher  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_breaks</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">largeN =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>), </span>
<span id="cb5-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ckmeans =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_breaks</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ckmeans"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
    expr       min       lq      mean    median        uq       max neval
  fisher 68.162320 69.48564 71.004707 70.333813 71.618909 89.183144   100
 ckmeans  2.706476  2.81163  2.946925  2.902102  3.023941  5.651169   100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_breaks</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">largeN =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>), </span>
<span id="cb7-2">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_breaks</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ckmeans"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-Wang2011Ckmeans" class="csl-entry">
Wang, Haizhou, and Mingzhou Song. 2011. <span>“Ckmeans.1d.dp: Optimal <img src="https://latex.codecogs.com/png.latex?k">-Means Clustering in One Dimension by Dynamic Programming.”</span> <em>The R Journal</em> 3 (2): 29–33. <a href="https://doi.org/10.32614/RJ-2011-015">https://doi.org/10.32614/RJ-2011-015</a>.
</div>
</div></section></div> ]]></description>
  <category>mapsf</category>
  <guid>https://rcarto.github.io/posts/mapsf_v0.12.0/</guid>
  <pubDate>Mon, 04 Nov 2024 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/mapsf_v0.12.0/front.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Raster maps with mapsf</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/mapsf_raster_v0.9.0/</link>
  <description><![CDATA[ 




<p><code>mapsf</code> focuses on creating thematic maps based on vector data, maps are mainly generated from <code>sf</code> objects.<br>
However, the latest update of <code>mapsf</code> (v0.9.0) expands its mapping capabilities for raster data. Emulating features from <code>terra</code> (and leveraging its plotting functions internally), <code>mf_raster()</code> now provides three map types for single band rasters: <strong>classes</strong>, <strong>continuous</strong>, and <strong>interval</strong>.<br>
Raster maps benefit from all map layout elements (title, scale bar, north arrow, graticules…) and can be mixed with vector objects.</p>
<p><small>Download datasets used in examples:</small> <a href="raster_data.zip"><i class="fa-solid fa-download" aria-label="download"></i></a></p>
<section id="classes" class="level2">
<h2 class="anchored" data-anchor-id="classes">Classes</h2>
<p>This type of map is suitable for qualitative data (categories, typologies).<br>
In this example we display a map of Corine Land Cover classes over the Lot region in France.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import raster</span></span>
<span id="cb1-4">clc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> terra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clc_46.tif"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import vector (Lot region polygon)</span></span>
<span id="cb1-7">dep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dep.gpkg"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dep"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) </span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a color palette</span></span>
<span id="cb1-10">clc_pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E6004D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FF0000"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#CC4DF2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#CC0000"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E6CCE6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A600CC"</span>, </span>
<span id="cb1-11">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFE6FF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFA8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E68000"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F2A64D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E6E64D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFE64D"</span>, </span>
<span id="cb1-12">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E6CC4D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#80FF00"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00A600"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#4DFF00"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#CCF24D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A6FF80"</span>, </span>
<span id="cb1-13">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A6E64D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A6F200"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00CCF2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#80F2E6"</span>)</span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map the raster</span></span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(clc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> clc_pal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb1-17">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_size =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_box_cex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>),</span>
<span id="cb1-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add region borders </span></span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(dep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add graticules</span></span>
<span id="cb1-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_graticule</span>(clc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>)</span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add map layout elements</span></span>
<span id="cb1-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CORINE Land Cover - Lot region - 2018"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tab =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>) </span>
<span id="cb1-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T. Giraud, 2024 | EEA 2018"</span>)</span>
<span id="cb1-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adjust =</span> clc)</span>
<span id="cb1-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_scale</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="continuous" class="level2">
<h2 class="anchored" data-anchor-id="continuous">Continuous</h2>
<p>This type of map is appropriate for quantitative data such as DEM, surface temperature or vegetation index.<br>
In the following examples we display elevation maps of the Lot region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import raster</span></span>
<span id="cb2-2">elev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> terra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elev_46.tif"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map the raster</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(elev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add layout elements</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation - Lot region"</span>) </span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM 90m DEM Digital Elevation Database, 2018"</span>)</span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adjust =</span> elev)</span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_scale</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The colors are set using a palette name or a vector of colors to map the continuous values.<br>
See <code>?hcl.colors()</code> examples to check palette names and colors.</p>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select a palette with a palette name</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(elev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rocket"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Continuous palette based on "Rocket"'</span>)</span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a palette with colors (from red to black)</span></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(elev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fe5234"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Continuous palette from "#fe5234" to "#000000"'</span>)</span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="480"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="480"></p>
</div>
</div>
</div>
<p>It is also possible to give break values and corresponding colors. Breaks are inflection points of the color scale. In this example the color palette varies from white to khaki between 67 and 150, then from khaki to darkgreen between 150 and 550, and finally from darkgreen to black between 550 and 776.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set a cartographic theme</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map the raster</span></span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(elev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">67</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">550</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">776</span>), </span>
<span id="cb4-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"khaki"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb4-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_rnd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_box_cex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb4-8">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation (m)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_horiz =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_frame =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb4-9">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_frame_border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>)</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add an inset </span></span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_inset_on</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"worldmap"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_worldmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> elev)</span>
<span id="cb4-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_inset_off</span>()</span>
<span id="cb4-15"></span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add layout elements</span></span>
<span id="cb4-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation - Lot region"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tab =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>) </span>
<span id="cb4-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T. Giraud, 2024 | SRTM 90m DEM Digital Elevation Database, 2018"</span>, </span>
<span id="cb4-19">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000CC"</span>)</span>
<span id="cb4-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adjust =</span> elev)</span>
<span id="cb4-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_scale</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb4-22"></span>
<span id="cb4-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add annotations</span></span>
<span id="cb4-24">max_elev_coord <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> terra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xyFromCell</span>(elev, terra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where.max</span>(elev)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span>
<span id="cb4-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_annotation</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> max_elev_coord, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Highest Point"</span>, </span>
<span id="cb4-26">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_arrow =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_txt =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, </span>
<span id="cb4-27">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">halo =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interval" class="level2">
<h2 class="anchored" data-anchor-id="interval">Interval</h2>
<p>This type of map is also appropriate for quantitative data.<br>
Numerical values are classified using one the methods provided by <code>mf_get_breaks()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set a cartographic theme</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map the raster</span></span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(elev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"interval"</span>, </span>
<span id="cb5-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"q6"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Turku"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rev =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb5-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_rnd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation (m)"</span>)</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add layout elements</span></span>
<span id="cb5-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation - Lot region"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tab =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>) </span>
<span id="cb5-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM 90m DEM Digital Elevation Database, 2018"</span>, </span>
<span id="cb5-12">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rightbottom"</span>)</span>
<span id="cb5-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>)</span>
<span id="cb5-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_scale</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomleft"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multiband" class="level2">
<h2 class="anchored" data-anchor-id="multiband">Multiband</h2>
<p>The last kind of map that <code>mf_raster()</code> can take care of is RGB composite maps using three bands.</p>
<p>In the following example we download an image from Open Street Map and display it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(maptiles)</span>
<span id="cb6-2">dep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(dep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:3857"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get an OpenStreetMap image on the region</span></span>
<span id="cb6-5">(osm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_tiles</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> dep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">provider =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OpenStreetMap"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crop =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 433, 448, 3  (nrow, ncol, nlyr)
resolution  : 305.7481, 305.7481  (x, y)
extent      : 109152.1, 246127.2, 5496740, 5629129  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / Pseudo-Mercator (EPSG:3857) 
source(s)   : memory
colors RGB  : 1, 2, 3 
names       : lyr.1, lyr.2, lyr.3 
min values  :     3,    54,     3 
max values  :   251,   249,   244 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set them margins</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display the map</span></span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(osm)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add region limits</span></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(dep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add attribution</span></span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_credit</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OpenStreetMap"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="492"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>mapsf</category>
  <guid>https://rcarto.github.io/posts/mapsf_raster_v0.9.0/</guid>
  <pubDate>Tue, 30 Jan 2024 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/mapsf_raster_v0.9.0/front.png" medium="image" type="image/png" height="132" width="144"/>
</item>
<item>
  <title>linemap update</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/linemap_0.3.0/</link>
  <description><![CDATA[ 




<p><img src="https://rcarto.github.io/posts/linemap_0.3.0/logo.png" align="right" width="140">The <code>linemap</code> package <span class="citation" data-cites="linemap">(Giraud 2023)</span> contains just one function: <code>linemap()</code>. <code>linemap()</code> displays a map made of lines using raster or gridded data.</p>
<p>In the previous version of the package, <code>linemap()</code> only accepted as input a <code>data.frame</code> of gridded data (in its long form: lon, lat, value). That was highly impractical.<br>
The main change introduced by this release is the ability to use a raster as input (a<code>SpatRaster</code> from <code>terra</code>).</p>
<p>In this example we use the sample dataset shipped with the package. <strong>elevation.tif</strong> is an elevation raster of Grenoble and the surrounding area (from SRTM).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(linemap)</span>
<span id="cb1-2">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> terra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tif/elevation.tif"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linemap"</span>))</span>
<span id="cb1-3">opar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey10"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linemap</span>(r)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(opar)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/linemap_0.3.0/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>We can use any kind of raster data. The following example uses gridded population data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data preparation</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(terra)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Download</span></span>
<span id="cb2-5">tempzip <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tempfile</span>()</span>
<span id="cb2-6">tempfolder <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tempdir</span>()</span>
<span id="cb2-7">data_url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://cidportal.jrc.ec.europa.eu/ftp/jrc-opendata/GHSL/"</span>, </span>
<span id="cb2-8">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHS_POP_GPW4_GLOBE_R2015A/GHS_POP_GPW42015_GLOBE_R2015A_54009_1k/"</span>, </span>
<span id="cb2-9">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1-0/GHS_POP_GPW42015_GLOBE_R2015A_54009_1k_v1_0.zip"</span>)</span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">download.file</span>(data_url, tempzip)</span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unzip</span>(tempzip, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exdir =</span> tempfolder)</span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import</span></span>
<span id="cb2-13">pop2015 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(tempfolder, </span>
<span id="cb2-14">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/GHS_POP_GPW42015_GLOBE_R2015A_54009_1k_v1_0/"</span>,</span>
<span id="cb2-15">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHS_POP_GPW42015_GLOBE_R2015A_54009_1k_v1_0.tif"</span>))</span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mask raster</span></span>
<span id="cb2-17">center <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">425483.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5608290</span>), </span>
<span id="cb2-18">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords=</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>)), </span>
<span id="cb2-19">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(pop2015))</span>
<span id="cb2-20">center <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_buffer</span>(center, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dist =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800000</span>)</span>
<span id="cb2-21">ras <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(pop2015, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_bbox</span>(center)[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)])</span>
<span id="cb2-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Smooth values</span></span>
<span id="cb2-23">model_r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ras</span>
<span id="cb2-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">res</span>(model_r) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb2-25">ras_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resample</span>(ras, model_r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>)</span>
<span id="cb2-26">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mask</span>(ras_res, center)</span></code></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(center, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linemap</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">txt =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inner =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f7f7f7"</span>, </span>
<span id="cb3-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#333333"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T. Giraud, 2023</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb3-8">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data : European Commission, Joint Research Centre (JRC); "</span>, </span>
<span id="cb3-9">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Columbia University, CIESIN (2015): GHS population grid, "</span>, </span>
<span id="cb3-10">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"derived from GPW4."</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/linemap_0.3.0/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>linemap</code> repository on GitHub: <a href="https://github.com/riatelab/linemap">github.com/riatelab/linemap</a></p>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-linemap" class="csl-entry">
Giraud, Timothée. 2023. <em><span class="nocase">linemap: Line Maps</span></em>. <a href="https://CRAN.R-project.org/package=linemap">https://CRAN.R-project.org/package=linemap</a>.
</div>
</div></section></div> ]]></description>
  <category>linemap</category>
  <guid>https://rcarto.github.io/posts/linemap_0.3.0/</guid>
  <pubDate>Tue, 28 Nov 2023 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/linemap_0.3.0/lm.png" medium="image" type="image/png" height="113" width="144"/>
</item>
<item>
  <title>mapsf update and maplegend introduction</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/mapsf_v0.8.0/</link>
  <description><![CDATA[ 




<p>An update of <code>mapsf</code> has been deployed on CRAN. In this article I will describe the changes introduced by this update.</p>
<p>The two main points are:</p>
<ul>
<li>the use of <code>maplegend</code> to plot legends,</li>
<li>the introduction of a new function <code>mf_distr()</code> to visualize univariate distributions.</li>
</ul>
<section id="legends" class="level2">
<h2 class="anchored" data-anchor-id="legends">Legends</h2>
<p>One of the main change introduced in the lastest release of <code>mapsf</code> is the use of the <code>maplegend</code> <span class="citation" data-cites="maplegend">(Giraud 2023)</span> package to plot all legends.</p>
<section id="the-maplegend-package" class="level3">
<h3 class="anchored" data-anchor-id="the-maplegend-package">The <code>maplegend</code> package</h3>
<p><a href="https://github.com/riatelab/maplegend"><code>maplegend</code></a> is a new package offering a wide range of legends. This package is primarily intended as a backend for building legends in <code>mapsf</code>. However, it can also be used independently from <code>mapsf</code> with <code>base</code> plots or even with <a href="https://gist.github.com/rCarto/da5a4b0cd982a8c85cb847506fd2f415"><code>igraph</code> plots</a>.</p>
<p>The main function is <code>leg()</code>. Its <code>type</code> argument defines the legend type.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(maplegend)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb1-3">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_mtq</span>()</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maplegend demo"</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Proportional symbols</span></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, </span>
<span id="cb1-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.mar"</span>), </span>
<span id="cb1-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'prop'"</span>)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, </span>
<span id="cb1-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.mar"</span>), </span>
<span id="cb1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'prop', horiz = TRUE"</span>)</span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choropleth </span></span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'choro'"</span>)</span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb1-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'choro', horiz = TRUE"</span>)</span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Typologie</span></span>
<span id="cb1-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"typo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>, </span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'typo'"</span>)</span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Symbols</span></span>
<span id="cb1-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"symb"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomleft"</span>, </span>
<span id="cb1-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, </span>
<span id="cb1-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'symb'"</span>)</span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Continuous</span></span>
<span id="cb1-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cont"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">722257.6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640619</span>), </span>
<span id="cb1-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb1-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'cont', horiz = TRUE"</span>)</span>
<span id="cb1-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cont"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">722257.6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1634576</span>), </span>
<span id="cb1-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'cont'"</span>)</span>
<span id="cb1-37"></span>
<span id="cb1-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Proportional lines</span></span>
<span id="cb1-39"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop_line"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, </span>
<span id="cb1-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, </span>
<span id="cb1-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'prop_line'"</span>)</span>
<span id="cb1-42"></span>
<span id="cb1-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Graduated lines</span></span>
<span id="cb1-44"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grad_line"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomright"</span>, </span>
<span id="cb1-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), </span>
<span id="cb1-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type = 'grad_line'"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Compound or stacked legends can be created with <code>leg_comp()</code> and <code>leg_draw()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(m)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stacked legends"</span>)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg_comp</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg_comp</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"typo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leg_draw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkblue"</span>, </span>
<span id="cb2-6">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame_border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.mar"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>maplegend</code> and <code>mapsf</code>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>You can use <code>maplegend::leg()</code> on maps created with <code>mapsf</code> but the preferred way is to use the <code>mf_legend()</code> function, which wraps <code>maplegend::leg()</code> with default values consistent with the current theme.</p></li>
<li><p>If you need to use <code>maplegend</code> with <code>mapsf</code> maps, to create compound legends for example, remember to fill the <code>mar</code> argument with the margin values of the current theme (<code>getOption("mapsf.mar")</code>) when using proportional symbols legends.</p></li>
</ul>
</div>
</div>
</section>
<section id="legends-in-mapsf" class="level3">
<h3 class="anchored" data-anchor-id="legends-in-mapsf">Legends in <code>mapsf</code></h3>
<p>A consequence of using <code>maplegend</code> in <code>mapsf</code> is the addition of several legend-related arguments in <code>mf_map()</code> to refine the legend display : <code>leg_frame_border</code>, <code>leg_horiz</code>, <code>leg_adj</code>, <code>leg_bg</code>, <code>leg_fg</code>, <code>leg_size</code>, <code>leg_border</code>, <code>leg_box_border</code>, <code>leg_box_cex</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(m, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MED"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>, </span>
<span id="cb3-2">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'topright'</span>,</span>
<span id="cb3-3">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_val_rnd =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb3-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_horiz =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb3-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_box_border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb3-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_box_cex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb3-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Median Income"</span></span>
<span id="cb3-8">       )</span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(m, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POP"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>, </span>
<span id="cb3-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Population'</span>,</span>
<span id="cb3-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomleft"</span>,</span>
<span id="cb3-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb3-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_frame =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb3-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ivory3"</span>, </span>
<span id="cb3-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_fg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tomato4"</span>, </span>
<span id="cb3-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_frame_border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, </span>
<span id="cb3-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_adj =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_credits</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TG 2023</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mapsf v0.8.0"</span>)</span>
<span id="cb3-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mf_map(..., leg_*) demo"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Legends for continuous rasters have been introduced.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> terra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ex/elev.tif"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"terra"</span>))</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_raster</span>(r)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_title</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Legends for continuous rasters"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Support for “classes” and “interval” types will be added in future versions.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>All <code>mf_legend_*()</code> function are deprecated. Use <code>mf_legend()</code> with the appropriate type instead.</p>
</div>
</div>
</section>
</section>
<section id="new-features" class="level2">
<h2 class="anchored" data-anchor-id="new-features">New features</h2>
<section id="mf_distr" class="level3">
<h3 class="anchored" data-anchor-id="mf_distr"><code>mf_distr()</code></h3>
<p><code>mf_distr()</code> is a function that displays a statistical distribution using a histogram, a box plot, a strip chart and a density curve on the same plot.<br>
This function was introduced to help users choose a method for creating class intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_distr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rev-argument" class="level3">
<h3 class="anchored" data-anchor-id="rev-argument"><code>rev</code> argument</h3>
<p>A <code>rev</code> argument has been added in <code>mf_map()</code>.<br>
<code>rev = TRUE</code> reverses the color order of the named palettes specified with the <code>pal</code> argument.</p>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(m, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MED"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quantile"</span>, </span>
<span id="cb6-3">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inferno"</span>)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(m, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MED"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choro"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quantile"</span>, </span>
<span id="cb6-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hcl.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inferno"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rev =</span> T)</span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="288"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.8.0/index_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="288"></p>
</div>
</div>
</div>
<hr>
<p><strong>See the <a href="https://raw.githubusercontent.com/riatelab/mapsf/master/NEWS.md">NEWS file</a> for the complete list of changes.</strong></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-maplegend" class="csl-entry">
Giraud, Timothée. 2023. <em><span class="nocase">maplegend: Legends for Maps</span></em>. <a href="https://CRAN.R-project.org/package=maplegend">https://CRAN.R-project.org/package=maplegend</a>.
</div>
</div></section></div> ]]></description>
  <category>mapsf</category>
  <category>maplegend</category>
  <guid>https://rcarto.github.io/posts/mapsf_v0.8.0/</guid>
  <pubDate>Thu, 23 Nov 2023 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/mapsf_v0.8.0/leg.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>How to Build a European-Wide OSRM Server on a Desktop Computer</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/build_osrm_server/</link>
  <description><![CDATA[ 




<p><a href="https://github.com/Project-OSRM/osrm-backend">Open Source Routing Machine</a>, or OSRM <span class="citation" data-cites="luxen-vetter-2011">(Luxen and Vetter 2011)</span>, is a routing software based on OpenStreetMap (OSM) data. OSRM can be used to find the fastest route between points, to compute time or distance matrices between set of points or to solve the <a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem">traveling salesman problem</a>.</p>
<p>As maintainer of the <code>osrm</code> R package <span class="citation" data-cites="giraud2022">(Giraud 2022)</span> I often find myself advising users to use their own instance of OSRM to enable them to send a large number of requests and not overload the demo server. In these cases I simply point to the Docker installation instructions in the project’s <a href="https://github.com/Project-OSRM/osrm-backend#using-docker">README</a> file. These instructions may not be detailed enough to build an OSRM instance on a large area.<br>
OSRM needs <strong>a lot</strong> of RAM to prepare the road network for requests and using only these instructions will probably result in message like this one:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[warn]</span> Please provide more memory or consider using a larger swapfile</span></code></pre></div>
<p>This problem is addressed in <a href="https://github.com/Project-OSRM/osrm-backend/issues/6146">this issue</a> on the OSRM GitHub repository. The suggested solution is to rent a temporary server. This is not the only solution, a modern computer with a rather classical hardware configuration can actually do the job.</p>
<p>In this post I’ll explain how to build a European-wide OSRM instance on a desktop computer. These explanations are, to a certain extent, also valid when using a remote server.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post implies some Linux/CLI/Docker knowledge from its reader.</p>
</div>
</div>
<section id="hardware" class="level2">
<h2 class="anchored" data-anchor-id="hardware">Hardware</h2>
<p>I use my personal laptop computer which has a 1 TB SSD hard drive and the following config:</p>
<pre><span style="color:#C01C28"><b>OS</b></span>: Debian GNU/Linux 12 (bookworm) x86_64 
<span style="color:#C01C28"><b>Host</b></span>: HP EliteBook 840 G8 Notebook PC 
<span style="color:#C01C28"><b>Kernel</b></span>: 6.1.0-10-amd64 
<span style="color:#C01C28"><b>CPU</b></span>: 11th Gen Intel i7-1185G7 (8) @ 4.800GHz 
<span style="color:#C01C28"><b>Memory</b></span>: 31.04GB </pre>
</section>
<section id="add-some-extra-memory" class="level2">
<h2 class="anchored" data-anchor-id="add-some-extra-memory">Add some extra memory</h2>
<p>The preparation of the OSM network for OSRM is memory intensive and will need more than the already available 32 GB of RAM. The <a href="https://en.wikipedia.org/wiki/Memory_paging">swap memory</a> is used when a program consume the totality of the available RAM memory. Consequently we need to <a href="https://github.com/Project-OSRM/osrm-backend/wiki/Running-OSRM#extracting-the-road-network-osrm-extract">extend the swap memory</a> of our computer. I use a very large file (a 200 GB file named “swap.swap”) to be sure to not exceed the limit.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># preallocate space to a file named swap.swap</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> fallocate <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span> 200G swap.swap</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change file access permissions</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> chmod 600 swap.swap</span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the file as a swap area</span></span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> mkswap swap.swap</span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># start swapping to the file</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> swapon swap.swap</span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># modify the swapiness</span></span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> sysctl vm.swappiness=20</span></code></pre></div>
</section>
<section id="download-the-osm-road-network" class="level2">
<h2 class="anchored" data-anchor-id="download-the-osm-road-network">Download the OSM road network</h2>
<p>The <a href="https://www.geofabrik.de/">Geofabrik website</a> provides <a href="https://download.geofabrik.de/">OSM database extracts</a> that can be used as input for OSRM. In our case we have downloaded the <strong>osm.pbf</strong> file for Europe (27.1 GB).</p>
</section>
<section id="build-the-dataset-for-osrm" class="level2">
<h2 class="anchored" data-anchor-id="build-the-dataset-for-osrm">Build the dataset for OSRM</h2>
<p>The <strong>europe-latest.osm.pbf</strong> file needs to be processed to be used by OSRM. This is done in three steps. You can change the transport mode in the first step, here we use the car profile.</p>
<ol type="1">
<li>Extract (~5h30)</li>
</ol>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${PWD}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:/data"</span> ghcr.io/project-osrm/osrm-backend:v5.27.1 osrm-extract <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> /opt/car.lua /data/europe-latest.osm.pbf</span></code></pre></div>
<ol start="2" type="1">
<li>Partition (~1h20)</li>
</ol>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${PWD}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:/data"</span> ghcr.io/project-osrm/osrm-backend:v5.27.1 osrm-partition /data/europe-latest.osrm</span></code></pre></div>
<ol start="3" type="1">
<li>Customize (~0h10)</li>
</ol>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${PWD}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:/data"</span> ghcr.io/project-osrm/osrm-backend:v5.27.1 osrm-customize /data/europe-latest.osrm</span></code></pre></div>
</section>
<section id="run-the-instance" class="level2">
<h2 class="anchored" data-anchor-id="run-the-instance">Run the instance</h2>
<p>This is the command I use to run this freshly built OSRM instance:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 5000:5000 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${PWD}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:/data"</span> ghcr.io/project-osrm/osrm-backend:v5.27.1 osrm-routed <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--algorithm</span> mld <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--max-table-size</span> 50000000 /data/europe-latest.osrm</span></code></pre></div>
</section>
<section id="other-experiments" class="level2">
<h2 class="anchored" data-anchor-id="other-experiments">Other experiments</h2>
<section id="a-laptop-with-lower-capacities" class="level3">
<h3 class="anchored" data-anchor-id="a-laptop-with-lower-capacities">A laptop with lower capacities:</h3>
<pre><span style="color:#C01C28"><b>OS</b></span>: Debian GNU/Linux 12 (bookworm) x86_64 
<span style="color:#C01C28"><b>Host</b></span>: HP EliteBook Folio 1040 G3 
<span style="color:#C01C28"><b>Kernel</b></span>: 6.1.0-12-amd64 
<span style="color:#C01C28"><b>CPU</b></span>: Intel i7-6600U (4) @ 3.400GHz 
<span style="color:#C01C28"><b>Memory</b></span>: 15.50GB </pre>
<ol type="1">
<li>Extract ~56h</li>
<li>Partition ~2h40</li>
<li>Customize ~1h</li>
</ol>
</section>
<section id="a-server-with-higher-capacities" class="level3">
<h3 class="anchored" data-anchor-id="a-server-with-higher-capacities">A server with higher capacities:</h3>
<pre><span style="color:#C01C28"><b>OS</b></span>: Ubuntu 22.04.3 LTS (Jammy Jellyfish) x86_64 
<span style="color:#C01C28"><b>Host</b></span>: ASUS 
<span style="color:#C01C28"><b>Kernel</b></span>: Linux 5.15.0-91-generic 
<span style="color:#C01C28"><b>CPU</b></span>: AMD Ryzen 7 7700 8-Core Processor (16) @ 5.388GHz 
<span style="color:#C01C28"><b>Memory</b></span>: 62GB </pre>
<ol type="1">
<li>Extract 1h06</li>
<li>Partition 0h34</li>
<li>Customize 0h02</li>
</ol>
</section>
</section>
<section id="example-of-use" class="level2">
<h2 class="anchored" data-anchor-id="example-of-use">Example of use</h2>
<p>This OSRM instance will actually be used in the framework of a European research program (<a href="https://www.ruralgranular.eu/">Granular</a>). In this project we’ll need to request a very large number of distances and routes throughout Europe in order to create relevant accessibility indicators for rural areas.<br>
I’ve built a small R package relying on <code>osrm</code> to send queries in a parallel fashion and create “All roads lead to…” maps. The <a href="https://github.com/rcarto/cobweb"><code>cobweb</code> package</a> is not bulletproof and it is not on CRAN.</p>
<p>Here is a small demo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remotes::install_github("rCarto/cobweb")</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cobweb)</span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cobweb</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">city =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mainz, Germany"</span>, </span>
<span id="cb7-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nroad =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncl =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, </span>
<span id="cb7-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://0.0.0.0:5000/"</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/build_osrm_server/map.png" class="img-fluid figure-img"></p>
<figcaption>All Roads Lead to Mainz!</figcaption>
</figure>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-giraud2022" class="csl-entry">
Giraud, Timothée. 2022. <span>“<span class="nocase">osrm: Interface Between R and the OpenStreetMap-Based Routing Service OSRM</span>.”</span> <em>Journal of Open Source Software</em> 7 (78): 4574. <a href="https://doi.org/10.21105/joss.04574">https://doi.org/10.21105/joss.04574</a>.
</div>
<div id="ref-luxen-vetter-2011" class="csl-entry">
Luxen, Dennis, and Christian Vetter. 2011. <span>“Real-Time Routing with OpenStreetMap Data.”</span> In <em>Proceedings of the 19th ACM SIGSPATIAL International Conference on Advances in Geographic Information Systems</em>, 513–16. GIS ’11. New York, NY, USA: ACM. <a href="https://doi.org/10.1145/2093973.2094062">https://doi.org/10.1145/2093973.2094062</a>.
</div>
</div></section></div> ]]></description>
  <category>osrm</category>
  <guid>https://rcarto.github.io/posts/build_osrm_server/</guid>
  <pubDate>Sun, 08 Oct 2023 22:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/build_osrm_server/cob.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>New release of mapsf</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/mapsf_v0.7.0/</link>
  <description><![CDATA[ 




<p>A minor update of <code>mapsf</code> has been deployed on CRAN. In this article I’ll describe the changes introduced by this update.</p>
<section id="new-features" class="level2">
<h2 class="anchored" data-anchor-id="new-features">New features</h2>
<section id="expandbb" class="level3">
<h3 class="anchored" data-anchor-id="expandbb"><code>expandBB</code></h3>
<p>An <code>expandBB</code> argument has been introduced in <code>mf_map()</code>. This argument allows to add some space around a map.</p>
<p>The following code displays a map with some extra space on the right side of the figure. This can be useful to add legends or annotations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-3">nc_raw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape/nc.shp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-4">nc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(nc_raw, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:32019"</span>)</span>
<span id="cb1-5">th <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"candy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ivory"</span>)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.7.0/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mf_get_ratio(nc[1,], expandBB = c(0,0.5,0,0), width = 3.5)</span></span></code></pre></div>
</div>
<p>This addition makes the <code>mf_init()</code> function virtually useless. These two script produce the same output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with mf_init()</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_init</span>(nc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ],  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># without mf_init()</span></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.7.0/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This argument has also been added to <code>mf_raster()</code>.</p>
</section>
<section id="mf_graticule" class="level3">
<h3 class="anchored" data-anchor-id="mf_graticule"><code>mf_graticule()</code></h3>
<p>A new <code>mf_graticule()</code> function has been added to the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_graticule</span>(nc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.7.0/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Graticules labels can be added on the four sides of the map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(nc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>))</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_graticule</span>(nc, </span>
<span id="cb5-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>), </span>
<span id="cb5-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb5-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb5-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.7.0/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>From <a href="https://r-spatial.github.io/sf/reference/st_graticule.html#use-of-graticules"><code>st_graticule()</code></a>:<br>
In cartographic visualization, the use of graticules is not advised, unless the graphical output will be used for measurement or navigation, or the direction of North is important for the interpretation of the content, or the content is intended to display distortions and artifacts created by projection. Unnecessary use of graticules only adds visual clutter but little relevant information. Use of coastlines, administrative boundaries or place names permits most viewers of the output to orient themselves better than a graticule.</p>
</div>
</div>
</section>
</section>
<section id="fixes" class="level2">
<h2 class="anchored" data-anchor-id="fixes">Fixes</h2>
<section id="pipe" class="level3">
<h3 class="anchored" data-anchor-id="pipe">Pipe</h3>
<p>The pipe compatibility of <code>mapsf</code> has been enhanced and it now works on most use cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_mtq</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ivory4"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POP"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_graticule</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.7.0/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="themes" class="level3">
<h3 class="anchored" data-anchor-id="themes">Themes</h3>
<p>The graphic theme feature has been refactored. The current theme parameters are now accessible via R options (with the <strong>mapsf.</strong> prefix).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$bg
[1] "#1B1D16"

$fg
[1] "#D7FF68"

$mar
[1] 0.5 0.5 2.0 0.5

$tab
[1] FALSE

$pos
[1] "center"

$inner
[1] FALSE

$line
[1] 1.5

$cex
[1] 1

$font
[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.bg"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#1B1D16"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.fg"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#D7FF68"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf.pos"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "center"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># etc</span></span></code></pre></div>
</div>
<p>The current theme is applied to all maps and there is no need to use the <code>theme</code> argument in <code>mf_export()</code> or <code>mf_init()</code> anymore.</p>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>The next release of <code>mapsf</code> will use the <a href="https://github.com/riatelab/maplegend"><code>maplegend</code></a> package (not on CRAN yet) for plotting legends. This will allow to plot horizontal legends (<a href="https://github.com/riatelab/mapsf/issues/19">#19</a>) and continuous legends for rasters (<a href="https://github.com/riatelab/mapsf/issues/22">#22</a>).</p>
<hr>
<p><strong>See the <a href="https://raw.githubusercontent.com/riatelab/mapsf/master/NEWS.md">NEWS file</a> for the complete list of changes.</strong></p>


</section>

 ]]></description>
  <category>mapsf</category>
  <guid>https://rcarto.github.io/posts/mapsf_v0.7.0/</guid>
  <pubDate>Mon, 10 Jul 2023 22:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/mapsf_v0.7.0/grat.png" medium="image" type="image/png" height="56" width="144"/>
</item>
<item>
  <title>New release of cartography</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/cartography_v3.1.3/</link>
  <description><![CDATA[ 




<p>A new version of <code>cartography</code> has been <a href="https://CRAN.R-project.org/package=cartography">released on CRAN</a> this week. <code>cartography</code> is a thematic mapping package for R that has entered in maintenance mode on March 2021.</p>
<p>This release has been triggered by the upcoming retirement (archiving) of <code>rgdal</code>, <code>rgeos</code> and <code>maptools</code> (see <a href="https://r-spatial.org/r/2022/04/12/evolution.html">R-spatial evolution: retirement of rgdal, rgeos and maptools</a> and <a href="https://r-spatial.org/r/2022/12/14/evolution2.html">Progress on R-spatial evolution, Dec 2022</a>).<br>
So, this release does not import any of these packages anymore and this is done at the cost of losing one function: <code>getTiles()</code>. The purpose of <code>getTiles()</code> was to download and compose raster tiles from a large number of providers.<br>
Fortunately, the <a href="https://github.com/riatelab/maptiles"><code>maptiles</code></a> package can be used to replace this function. It has the same features and is more robust.</p>
<p>For the same kind of reasons, <code>smoothLayer()</code> function has been deprecated. This function is using the <code>SpatialPosition</code> package to compute potentials. Potentials computations are now offered by the <code>potential</code> package.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key messages for <code>cartography</code> users
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Consider switching from <code>cartography</code> to <code>mapsf</code>. <code>mapsf</code> is the successor of <code>cartography</code>, it offers the same core features, it is friendlier, lighter and more robust.<br>
</li>
<li>Use <code>maptiles</code> instead of <code>getTiles()</code>. It offers the same features using a modern packages.</li>
<li>Use <code>potential</code> instead of <code>smoothLayer()</code>. It offers more features using modern packages.</li>
</ul>
<p><a href="https://riatelab.github.io/mapsf"><img src="https://rcarto.github.io/posts/cartography_v3.1.3/mapsf.png" class="img-fluid" width="120"></a> <a href="https://github.com/riatelab/maptiles"><img src="https://rcarto.github.io/posts/cartography_v3.1.3/maptiles.png" class="img-fluid" width="120"></a> <a href="https://riatelab.github.io/potential"><img src="https://rcarto.github.io/posts/cartography_v3.1.3/potential.png" class="img-fluid" width="120"></a></p>
</div>
</div>
<p><strong>See the <a href="https://raw.githubusercontent.com/riatelab/cartography/master/NEWS">NEWS file</a> for the complete list of changes.</strong></p>



 ]]></description>
  <category>cartography</category>
  <guid>https://rcarto.github.io/posts/cartography_v3.1.3/</guid>
  <pubDate>Thu, 19 Jan 2023 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/cartography_v3.1.3/cartography.png" medium="image" type="image/png" height="166" width="144"/>
</item>
<item>
  <title>New release of mapsf</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/mapsf_v0.6.1/</link>
  <description><![CDATA[ 




<p>The R spatial ecosystem is rich, dynamic and mature and several packages allow to import, process and represent spatial data. The <a href="https://CRAN.R-project.org/package=mapsf"><code>mapsf</code></a> package <span class="citation" data-cites="mapsf">(Giraud 2022)</span> relies on this ecosystem to integrate the creation of quality thematic maps in R workflows. <code>mapsf</code> uses <code>sf</code> objects to produce <code>base</code> graphics.</p>
<p>A minor update of <code>mapsf</code> has been deployed on CRAN. In this article I’ll describe the changes introduced by this update. <code>mapsf</code> has noticeably gained a new function, <code>mf_get_ratio()</code>, that helps to create map figures with suitable width / height ratios. Most of the other changes are bug fixes and small improvements.</p>
<section id="new-features" class="level2">
<h2 class="anchored" data-anchor-id="new-features">New features</h2>
<section id="mf_get_ratio" class="level3">
<h3 class="anchored" data-anchor-id="mf_get_ratio"><code>mf_get_ratio()</code></h3>
<p><code>mf_get_ratio()</code> can be used to create map figures with a suitable width / height ratio in reports (*.Rmd, *.qmd).<br>
It uses the width / height ratio of a spatial object bounding box to find a matching ratio for the map.<br>
The following quarto example uses the default figure output settings (7 x 5 inches):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb1-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">library(mapsf)</span></span>
<span id="cb1-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mtq &lt;- mf_get_mtq()</span></span>
<span id="cb1-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_theme("darkula")</span></span>
<span id="cb1-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_map(mtq)</span></span>
<span id="cb1-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.6.1/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The width / height ratio of this figure is not optimal, it produces a lot of unused space on the sides of the map. It is not easy to find a correct ratio without manually fiddling with the <strong>fig-width</strong> and <strong>fig-height</strong> values and this can be exhausting.<br>
<code>mf_get_ratio()</code> helps with this task:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_ratio</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mtq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkula"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.3 5.0</code></pre>
</div>
</div>
<p>We can use these values to obtain a much more satisfactory figure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb4-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-width: 4.3</span></span>
<span id="cb4-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-height: 5</span></span>
<span id="cb4-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_theme("darkula")</span></span>
<span id="cb4-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_map(mtq)</span></span>
<span id="cb4-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.6.1/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="412"></p>
</figure>
</div>
</div>
</div>
<p>The <code>mf_init()</code> function can be used to expand the map space in any direction thanks to its <strong>expandBB</strong> argument.<br>
Lets say we want to produce a figure that uses the <strong>ink</strong> theme, with a height of 5 inches and some space left on the right of the map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_ratio</span>(</span>
<span id="cb5-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mtq, </span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ink"</span>, </span>
<span id="cb5-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb5-6">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.95 5.00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb7-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-width: 5.95</span></span>
<span id="cb7-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-height: 5</span></span>
<span id="cb7-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_init(x = mtq, expandBB = c(0, 0, 0, .5), theme = "ink")</span></span>
<span id="cb7-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_map(mtq, add = TRUE)</span></span>
<span id="cb7-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">mf_title("Martinique")</span></span>
<span id="cb7-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.6.1/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="571"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="maps-of-proportional-and-colored-lines" class="level3">
<h3 class="anchored" data-anchor-id="maps-of-proportional-and-colored-lines">Maps of proportional and colored lines</h3>
<p>It is now possible to create maps that combine proportional lines and colors using the <strong>prop_typo</strong> map type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_theme</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span>)</span>
<span id="cb8-2">mtq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_mtq</span>()</span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import the csv file embedded in mapsf</span></span>
<span id="cb8-4">mob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"csv/mob.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf"</span>))</span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select links from Fort-de-France (97209))</span></span>
<span id="cb8-6">mob_97209 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mob[mob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97209</span>, ]</span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create an sf object of links</span></span>
<span id="cb8-8">mob_links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_links</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mtq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> mob_97209)</span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initiate a map with some space on the right</span></span>
<span id="cb8-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_init</span>(mtq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expandBB =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(mtq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(</span>
<span id="cb8-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mob_links,</span>
<span id="cb8-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fij"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sj"</span>),</span>
<span id="cb8-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop_typo"</span>,</span>
<span id="cb8-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd_max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb8-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>),</span>
<span id="cb8-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nb. of commuters"</span>, </span>
<span id="cb8-19">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Municipality status"</span>)</span>
<span id="cb8-20">)</span>
<span id="cb8-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map layout</span></span>
<span id="cb8-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_layout</span>(</span>
<span id="cb8-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Commuting from Fort-de-France"</span>,</span>
<span id="cb8-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">credits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb8-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sources: Insee and IGN, 2018</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb8-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">packageVersion</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapsf"</span>)</span>
<span id="cb8-27">  ),</span>
<span id="cb8-28">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb8-29">)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.6.1/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bug-fixes-and-improvements" class="level2">
<h2 class="anchored" data-anchor-id="bug-fixes-and-improvements">Bug fixes and improvements</h2>
<ul>
<li>Messages are now displayed when users map proportional symbols based on a variable that contained either <code>NA</code>, <code>0</code>, <code>Inf</code> or negative values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapsf)</span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import sample dataset</span></span>
<span id="cb9-3">mtq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_mtq</span>()</span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># introduce NA, 0, Inf and negative values</span></span>
<span id="cb9-5">mtq[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POP"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20000</span>)</span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display basemap</span></span>
<span id="cb9-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(mtq)</span>
<span id="cb9-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mtq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POP"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2 'NA' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2 '0' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2 'Infinite' values are not plotted on the map.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Negative values have been transformed into positive values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.6.1/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p><code>mf_get_breaks()</code> is a function that helps to classify continuous variables using various methods, including the ones from <code>classInt::classIntervals</code> <span class="citation" data-cites="classInt">(Bivand 2022)</span>. A control has been added for <code>Inf</code> values and the <strong>geom</strong> method now outputs an error when all values are not strictly positive.</p></li>
<li><p>It is now possible to create maps with only one proportional symbol. This can be useful when maps are generated iterating over multiple territories: some of them may have only one point to plot (see <a href="https://github.com/riatelab/mapsf/issues/45">issue #45</a>).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">opar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb14-2">mtq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_get_mtq</span>()</span>
<span id="cb14-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(mtq[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,])</span>
<span id="cb14-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mtq[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POP"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>, </span>
<span id="cb14-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val_max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">leg_pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomleft"</span>)</span>
<span id="cb14-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(mtq[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,])</span>
<span id="cb14-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mf_map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mtq[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POP"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span>, </span>
<span id="cb14-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val_max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85000</span>)</span>
<span id="cb14-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(opar)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rcarto.github.io/posts/mapsf_v0.6.1/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><strong>See the <a href="https://raw.githubusercontent.com/riatelab/mapsf/master/NEWS">NEWS file</a> for the complete list of changes.</strong></p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-classInt" class="csl-entry">
Bivand, Roger. 2022. <em>classInt: Choose Univariate Class Intervals</em>. <a href="https://CRAN.R-project.org/package=classInt">https://CRAN.R-project.org/package=classInt</a>.
</div>
<div id="ref-mapsf" class="csl-entry">
Giraud, Timothée. 2022. <em><span class="nocase">mapsf</span>: Thematic Cartography</em>. <a href="https://CRAN.R-project.org/package=mapsf">https://CRAN.R-project.org/package=mapsf</a>.
</div>
</div></section></div> ]]></description>
  <category>mapsf</category>
  <guid>https://rcarto.github.io/posts/mapsf_v0.6.1/</guid>
  <pubDate>Mon, 12 Dec 2022 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/mapsf_v0.6.1/mapsf.png" medium="image" type="image/png" height="166" width="144"/>
</item>
<item>
  <title>New release of osrm</title>
  <dc:creator>Timothée Giraud</dc:creator>
  <link>https://rcarto.github.io/posts/osrm_v4.0.0/</link>
  <description><![CDATA[ 




<p><a href="https://CRAN.R-project.org/package=osrm"><code>osrm</code></a> is an interface between R and the <a href="https://github.com/Project-OSRM/osrm-backend">Open Source Routing Machine</a> (OSRM) API. OSRM <span class="citation" data-cites="luxen-vetter-2011">(Luxen and Vetter 2011)</span> is a routing service based on OpenStreetMap (OSM) data. This package enables the computation of routes, trips, isochrones and travel distances matrices (travel times and kilometric distances) based on the OSM road network.</p>
<p>A major update of <code>osrm</code> has been deployed on CRAN two weeks ago. In this article I’ll describe the changes introduced by this update and explain its context: the submission of a paper <span class="citation" data-cites="giraud2022">(Giraud 2022)</span> about the package in <a href="https://joss.theoj.org/">Journal of Open Source Software</a> (JOSS).</p>
<section id="what-has-changed" class="level2">
<h2 class="anchored" data-anchor-id="what-has-changed">What has changed</h2>
<p>This major release introduces a number of changes to the package API, some of them are <a href="https://en.wiktionary.org/wiki/breaking_change">breaking changes</a>.</p>
<section id="sp-support" class="level3">
<h3 class="anchored" data-anchor-id="sp-support"><code>sp</code> support</h3>
<p>Users will no longer have the possibility to use an <code>sp</code> object as input or output in <code>osrm</code> functions. Most of <em>#rspatial</em> users and package developers have moved from the old <code>sp</code>/<code>rgeos</code>/<code>rgdal</code> trilogy toward the <code>sf</code> package.</p>
</section>
<section id="refactoring-of-the-request-handling-process" class="level3">
<h3 class="anchored" data-anchor-id="refactoring-of-the-request-handling-process">Refactoring of the request handling process</h3>
<p>The way requests are sent to the OSRM server (local/remote/demo) has been refactored in order to get more informative messages. Indeed, an important share of the issues posted on the <a href="https://github.com/riatelab/osrm/issues"><code>osrm</code> GitHub repo</a> has been about cryptic or non helpful error messages sent by the package or the server. So in this release OSRM server errors are more explicit and better transmitted to the user.</p>
</section>
<section id="dependencies" class="level3">
<h3 class="anchored" data-anchor-id="dependencies">Dependencies</h3>
<p>OSRM request are received as json files to the package. Former versions of the package used <code>jsonlite</code>. Following a suggestion by <a href="https://github.com/neon-ninja">Nick Young</a> I’ve replaced this package by a much more efficient package (for large files), <a href="https://CRAN.R-project.org/package=RcppSimdJson"><code>RcppSimdJson</code></a>.<br>
The construction of isochrones as polygons was based on an ad-hoc code supported by <a href="https://CRAN.R-project.org/package=isoband"><code>isoband</code></a>. This piece of code was replicated in 2 other packages (<a href="https://CRAN.R-project.org/package=tanaka"><code>tanaka</code></a> and <a href="https://CRAN.R-project.org/package=potential"><code>potential</code></a>). I’ve decided to create the <a href="https://CRAN.R-project.org/package=mapiso"><code>mapiso</code></a> package to avoid an unnecessary maintenance burden and fortify the underlying code.</p>
</section>
<section id="input-types" class="level3">
<h3 class="anchored" data-anchor-id="input-types">Input types</h3>
<p>Input type checking has been largely improved. This improvement have lead to a modification of the set of valid input of functions. Most functions accept data.frame, matrix, sfc or sf objects. The way identifier are handled has also been improved (use of row.names or indexes if row.names are not relevant, e.g.&nbsp;for sfc objects or some matrices).</p>
<p>See the <a href="https://raw.githubusercontent.com/riatelab/osrm/master/NEWS">NEWS file</a> for the complete list of changes.</p>
</section>
</section>
<section id="the-paper-in-joss" class="level2">
<h2 class="anchored" data-anchor-id="the-paper-in-joss">The paper in JOSS</h2>
<p><a href="https://joss.theoj.org/papers/10.21105/joss.04574"><img src="https://rcarto.github.io/posts/osrm_v4.0.0/2022-11-04_12-42.png" class="img-fluid"></a></p>
<p><em>From <a href="https://joss.readthedocs.io/en/latest/submitting.html">JOSS documentation</a></em>:<br>
JOSS publishes articles about research software. JOSS submissions must be open source and have an obvious research application. After submission an editor will carry out an initial check of your submission, and proceed to assign a handling editor. The handling editor will assign two or more JOSS reviewers, and the review will be carried out in the JOSS reviews repository. Authors will respond to reviewer-raised issues on the submission repository’s issue tracker.</p>
<p>The review process of the paper happens in the open. You can have a look at it <a href="https://github.com/openjournals/joss-reviews/issues/4574">here</a>.<br>
Submitting a paper to JOSS assure you to have your software inspected by a set of competent people and I can say that this process help me to make the package more ergonomic and reliable.</p>
<p>If you want more detailed information on JOSS, a paper by <span class="citation" data-cites="smith2018">Smith et al. (2018)</span> describes the motivation, design, and progress of the journal.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-giraud2022" class="csl-entry">
Giraud, Timothée. 2022. <span>“<span class="nocase">osrm: Interface Between R and the OpenStreetMap-Based Routing Service OSRM</span>.”</span> <em>Journal of Open Source Software</em> 7 (78): 4574. <a href="https://doi.org/10.21105/joss.04574">https://doi.org/10.21105/joss.04574</a>.
</div>
<div id="ref-luxen-vetter-2011" class="csl-entry">
Luxen, Dennis, and Christian Vetter. 2011. <span>“Real-Time Routing with OpenStreetMap Data.”</span> In <em>Proceedings of the 19th ACM SIGSPATIAL International Conference on Advances in Geographic Information Systems</em>, 513–16. GIS ’11. New York, NY, USA: ACM. <a href="https://doi.org/10.1145/2093973.2094062">https://doi.org/10.1145/2093973.2094062</a>.
</div>
<div id="ref-smith2018" class="csl-entry">
Smith, Arfon M., Kyle E. Niemeyer, Daniel S. Katz, Lorena A. Barba, George Githinji, Melissa Gymrek, Kathryn D. Huff, et al. 2018. <span>“<span>Journal of Open Source Software (JOSS): Design and First-Year Review</span>.”</span> <em>PeerJ Computer Science</em> 4 (February): e147. <a href="https://doi.org/10.7717/peerj-cs.147">https://doi.org/10.7717/peerj-cs.147</a>.
</div>
</div></section></div> ]]></description>
  <category>osrm</category>
  <guid>https://rcarto.github.io/posts/osrm_v4.0.0/</guid>
  <pubDate>Thu, 03 Nov 2022 23:00:00 GMT</pubDate>
  <media:content url="https://rcarto.github.io/posts/osrm_v4.0.0/osrm.png" medium="image" type="image/png" height="167" width="144"/>
</item>
</channel>
</rss>
